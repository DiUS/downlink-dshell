#!/usr/bin/env ruby

require "dshell"

Dshell do
  instructions "Type 'help' for help"

  help :history, "Show the list of commands you've entered so far"
  command :history do
    puts history
  end

  help :ls, "Show the list of commands you've entered so far"
  command :ls do
    puts `ls #{current_dir}`
  end

  help :cat, "Prints out the content of the specified files"
  command :cat do |argv|
    if argv.empty?
      show_error "No file specified"
    else
      #FIXME: This will allow them to break out of the
      # virtual filesystem.
      argv = argv.map do |file|
        [file, Pathname.new(File.expand_path(file, current_dir))]
      end
      argv.each do |name, file|
        if file.exist?
          puts `cat #{file}`
        else
          show_error(
            "#{name}: No such file or directory"
          )
        end
      end
    end
  end

  help :cd, "Change directory"
  command :cd do |argv|
    change_dir argv.join(' ')
  end

  help :pwd, "Prints the current directory"
  command :pwd do |argv|
    puts virtual_file_for current_dir
  end

end
